---
title: Group Sold Products By The Date
description: Group Sold Products By The Date
---

import { Badge } from "@astrojs/starlight/components";

<Badge text="Easy" variant="note" />
<Badge text="Advanced String Functions / Regex / Clause" variant="note" />

Hitung jumlah produk unik per tanggal dan gabungkan nama produknya menggunakan `COUNT(DISTINCT)`, `STRING_AGG()`, dan `GROUP BY`.

https://leetcode.com/problems/group-sold-products-by-the-date

## Soal

> Table: `Activities`
>
> ```
> +-------------+---------+
> | Column Name | Type    |
> +-------------+---------+
> | sell_date   | date    |
> | product     | varchar |
> +-------------+---------+
> ```
>
> There is no primary key (column with unique values) for this table. It may contain duplicates.
>
> Each row of this table contains the product name and the date it was sold in a market.

Write a solution to find for each date the number of different products sold and their names.

The sold products names for each date should be sorted lexicographically.

Return the result table ordered by `sell_date`.

The result format is in the following example.

> **Example 1:**
>
> Input:
>
> `Activities` table:
>
> ```
> +------------+------------+
> | sell_date  | product     |
> +------------+------------+
> | 2020-05-30 | Headphone  |
> | 2020-06-01 | Pencil     |
> | 2020-06-02 | Mask       |
> | 2020-05-30 | Basketball |
> | 2020-06-01 | Bible      |
> | 2020-06-02 | Mask       |
> | 2020-05-30 | T-Shirt    |
> +------------+------------+
> ```
>
> Output:
>
> ```
> +------------+----------+------------------------------+
> | sell_date  | num_sold | products                     |
> +------------+----------+------------------------------+
> | 2020-05-30 | 3        | Basketball,Headphone,T-shirt |
> | 2020-06-01 | 2        | Bible,Pencil                 |
> | 2020-06-02 | 1        | Mask                         |
> +------------+----------+------------------------------+
> ```
>
> **Explanation:**
> - For 2020-05-30, Sold items were (Headphone, Basketball, T-shirt), we sort them lexicographically and separate them by a comma.
> - For 2020-06-01, Sold items were (Pencil, Bible), we sort them lexicographically and separate them by a comma.
> - For 2020-06-02, the Sold item is (Mask), we just return it.

## Setup Soal

Buat tabel dan insert data contoh:

```sql
CREATE TABLE Activities (
    sell_date DATE,
    product VARCHAR(100)
);

INSERT INTO Activities (sell_date, product) VALUES
    ('2020-05-30', 'Headphone'),
    ('2020-06-01', 'Pencil'),
    ('2020-06-02', 'Mask'),
    ('2020-05-30', 'Basketball'),
    ('2020-06-01', 'Bible'),
    ('2020-06-02', 'Mask'),
    ('2020-05-30', 'T-Shirt');
```

## Jawaban SQL

```sql
SELECT 
    sell_date,
    COUNT(DISTINCT product) AS num_sold,
    STRING_AGG(DISTINCT product, ',' ORDER BY product) AS products
FROM Activities
GROUP BY sell_date
ORDER BY sell_date;
```

## Penjelasan

Soal ini meminta kita menghitung jumlah produk **unik** per tanggal dan menggabungkan nama produknya dalam satu string yang dipisahkan koma.

### 1. COUNT(DISTINCT product)

```sql
COUNT(DISTINCT product) AS num_sold
```

`COUNT(DISTINCT product)` menghitung jumlah produk **unik** di setiap grup (tanggal).

Contoh untuk tanggal 2020-05-30:
```
Produk yang dijual: Headphone, Basketball, T-Shirt
COUNT(DISTINCT product) = 3
```

Contoh untuk tanggal 2020-06-02:
```
Produk yang dijual: Mask, Mask (duplikat)
COUNT(DISTINCT product) = 1 (Mask dihitung sekali)
```

**Kenapa pakai DISTINCT?**

Karena bisa ada produk yang sama dijual beberapa kali di tanggal yang sama (seperti Mask di 2020-06-02). Kita hanya mau hitung produk unik.

### 2. STRING_AGG(DISTINCT product, ',' ORDER BY product)

```sql
STRING_AGG(DISTINCT product, ',' ORDER BY product) AS products
```

`STRING_AGG()` adalah fungsi agregat yang menggabungkan nilai dari beberapa baris menjadi satu string.

**Parameter:**
- `DISTINCT product`: Ambil produk unik (hilangkan duplikat)
- `','`: Separator (pemisah) antar produk
- `ORDER BY product`: Urutkan produk secara lexicographical (alfabetis)

Contoh untuk tanggal 2020-05-30:
```
Produk: Headphone, Basketball, T-Shirt

Setelah DISTINCT: Headphone, Basketball, T-Shirt
Setelah ORDER BY: Basketball, Headphone, T-Shirt
Setelah STRING_AGG dengan ',': "Basketball,Headphone,T-shirt"
```

Perhatikan: Hasil `STRING_AGG` hanya pakai koma (`,`) **tanpa spasi** setelah koma!

Contoh untuk tanggal 2020-06-02:
```
Produk: Mask, Mask

Setelah DISTINCT: Mask
Setelah STRING_AGG: "Mask"
```

### 3. GROUP BY dan ORDER BY

```sql
GROUP BY sell_date
ORDER BY sell_date
```

- `GROUP BY sell_date`: Kelompokkan data berdasarkan tanggal
- `ORDER BY sell_date`: Urutkan hasil berdasarkan tanggal

### Hasil Akhir

```
+------------+----------+------------------------------+
| sell_date  | num_sold | products                     |
+------------+----------+------------------------------+
| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |
| 2020-06-01 | 2        | Bible,Pencil                 |
| 2020-06-02 | 1        | Mask                         |
+------------+----------+------------------------------+
```

## Referensi

- `SELECT`: Memilih kolom yang akan ditampilkan.
- `FROM`: Menentukan tabel sumber data.
- `GROUP BY`: Mengelompokkan baris berdasarkan nilai kolom tertentu.
- `ORDER BY`: Mengurutkan hasil query.
- `COUNT(DISTINCT column)`: Menghitung jumlah nilai unik dalam kolom.
- `STRING_AGG(column, separator ORDER BY column)`: Menggabungkan nilai dari beberapa baris menjadi satu string dengan separator tertentu.
- `DISTINCT`: Menghilangkan duplikasi nilai.
- `AS`: Memberi alias untuk kolom hasil query.
- Lexicographical Order: Urutan alfabetis (A-Z).
